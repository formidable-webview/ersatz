:hide-uri-scheme:
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:toc:

= @formidable-webview/iframe

A `WebView` component for
https://github.com/necolas/react-native-web[react-native-web] aimed at feature parity.

== Features

[WARNING]
====
Some features will only work on *same origins*. Check the *Origin* column for
each prop. That is, under one of these three conditions:

* When using `source={{ html }}` prop;
* When using `source={{ uri }}` prop *and* the `uri` domain is equal to the
page domain;
* When using `source={{ uri }}` prop *and* the `uri` domain shares a
superdomain with the page domain *and* both pages declare the same
superdomain with `document.domain`.

You are strongly advised to read the <<security>> chapter to know more.

====

=== Shared Props

This is a support overview for https://github.com/react-native-community/react-native-webview/blob/master/src/WebViewTypes.ts[`WebViewSharedProps`] in this library.

==== Behavior Props

[width="100%",options="header"]
|===
| Prop | Support | Origin | Comments

| `javaScriptEnabled`
| :heavy_check_mark:
| Any
| When `sandboxEnabled` is `false`, JavaScript will always be enabled.

| `containerStyle`
| :heavy_check_mark:
| Any
| Default styling is guaranteed strictly equivalent with community `WebView` for mobile
platforms.

| `style`
| :heavy_check_mark:
| Any
| Default styling is guaranteed strictly equivalent with community `WebView` for mobile
platforms.

| `renderError`
| :heavy_check_mark:
|  Any
| Because HTTP requests from the browser cannot be accessed for obvious
security reasons, and `onerror` events are not triggered on iframes in modern
browsers, we use a little trick: we send an opaque HTTP HEAD request to the
resource, and catch an error when the host is unavailable. You can disable this
feature by setting `errorRenderingEnabled` to `false`.

| `renderLoading`
| :heavy_check_mark:
| Any
|

| `mediaPlaybackRequiresUserAction`
| :heavy_check_mark:
| Any
|

| `showsHorizontalScrollIndicator`
| :heavy_check_mark:
| Any
|

| `showsVerticalScrollIndicator`
| :heavy_check_mark:
| Any
|

| `source`
| :warning:
| Any
| Both remote URI (with the exception of `body`, `headers` and `method`) and inline HTML (including `baseUrl`) are supported. Local files are not supported.

| `injectedJavaScript`
| :warning:
| Same origin
|

| `injectedJavaScriptBeforeContentLoaded`
| :warning:
| Same origin
|

| `originWhitelist`
| :warning:
| Same origin
| Note that contrary to mobile platforms, this prop will default to `[]`, because it makes little sense to allow navigation within the iframe.

| `injectedJavaScriptForMainFrameOnly`
| :x:
| Any
| Consider the behavior of `web` as if this prop was forced to `true`.

| `injectedJavaScriptBeforeContentLoadedForMainFrameOnly`
| :x:
| Any
| Consider the behavior of Ersatz as if this prop was forced to `true`.

| `nativeConfig`
| :x:
| None
|

| `userAgent`
| :x:
| None
|

| `applicationNameForUserAgent`
| :x:
| None
|

| `allowsFullscreenVideo`
| :x:
| None
| Note about `allow: fullscreen`

| `cacheEnabled`
| :x:
| None
|

| `javaScriptCanOpenWindowsAutomatically`
| :x:
| None
| Popups opened with `window.open` will be suppressed by a majority of modern browsers.

| `startInLoadingState`
| :x:
| None
|

|===

==== Event Handlers Props

[width="100%",cols="16%,8%,16,60%",options="header",]
|===
| Event Handler
| Support
| Origin
| Comments

| `onScroll`
| :heavy_check_mark:
| Any
|

| `onLoad`
| :heavy_check_mark:
| Any
| Invoked when the WebView has finished the load operation with success.

| `onLoadEnd`
| :heavy_check_mark:
| Any
| Invoked when the WebView has finished the load operation, either with a success or failure 

| `onError`
| :heavy_check_mark:
| Any
| Invoked when the WebView has finished the load operation with a failure.

| `onLoadStart`
| :heavy_check_mark:
| Any
| Invoked when the WebView is starting to load from a source object. 

| `onLoadProgress`
| :heavy_check_mark:
| Any
| Although we support this, only one event will be fired at the end with `progress: 1`.

| `onMessage`
| :warning:
| Same Origin
| Invoked when a script in the backend
has posted a message with `window.ReactNativeWebView.postMessage`.

| `onNavigationStateChange`
| :warning:
| Same Origin
| Navigation events from a cross origin will not be tracked.

| `onShouldStartLoadWithRequest`
| :warning:
| Same Origin
| Navigation events from a cross origin will not be cancelable.

| `onHttpError`
| :x:
| None
| There is no way to access HTTP requests submitted by browsers.

| `onFileDownload`
| :x:
| None
|
|===


=== Web-only Props

[width="100%",options="header"]
|===
|Prop | Type | Default | Origin |Comments

| `csp`
| `string`
| `undefined`
| Any
| Set iframe
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-csp[`csp`
attribute].

| `referrerPolicy`
| `string`
| `undefined`
| Any
| Set iframe
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-referrerpolicy[`referrerpolicy`
attribute].

| `geolocationEnabled`
| `boolean`
| `false`
| Any
| Sets whether Geolocation API can be used.

| `fullscreenEnabled`
| `boolean`
| `true`
| Any
| Sets whether Fullscreen API can be used.

| `paymentEnabled`
| `boolean`
| `true`
| Any
| Sets whether PaymentRequest API can be used.

| `lazyLoadingEnabled`
| `boolean`
| `false`
| Any
| Set iframe
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-loading[`loading="lazy"`
attribute]. This feature has the potential to boost page loading performances and limit
memory consumption, but is yet experimental.

| `sandboxEnabled`
| `boolean`
| `true`
| Any
| By default, the iframe will be
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox[sandboxed]
for safety. You can disable this behavior by setting this prop to `true`. Read
more about the security risks associated with removing sandboxing
https://looker.com/blog/iframe-sandbox-tutorial[here].

| `messagingEnabled`
| `boolean`
| `true`
| Any
| Sets whether `WebView` messaging is enabled.

| `sandbox`
| `string`
| `"allow-same-origin allow-modals allow-popups allow-forms"`
| Any
| Override iframe
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox[`sandbox`
attribute] to lift sandbox restrictions.

| `webPolicies`
| `{
  [k in string]: boolean \| string
}`
| `{
  documentDomain: true
}`
| Any
| A map to override iframe
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-allow[allow attribute]
to set permission policies. If you need access to a specific
peripherals, it can be allowed here (microphone, camera, battery ...).
Each key is the name of a policy, camelCased, and each value is either:

* `true`, which will enable the permission with default allowlist;
* `false`, which will disable the permission by setting allowlist to `'none'`;
* a string, which should follow the syntax of an allowlist to specify origins.

Read more about allowlist syntax https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy/Using_Feature_Policy#allowlist[on MDN].

*Remarks*: Some policies will be derived from specific props such as `fullscreenEnabled`.
When you set `webPolicies` prop, policies derived from props will be
merged into, meaning you can override them, but they will otherwise be preserved.

|===

=== Instance Methods

For any of the unsupported methods, a method is defined but will do nothing
when invoked.

[width="100%",cols="18%,18%,14%,60%",options="header",]
|===
| Method
| Support
| Origin
| Comments

| `requestFocus`
| :heavy_check_mark:
| Any
|

| `injectJavaScript`
| :warning:
| Same Origin
| Document is not accessible in cross-origins iframes.

| `reload`
| :warning:
| Any
| Reload works, but navigation history will be lost.

| `goBack`
| :x:
| None
| Navigation is not supported.

| `goForward`
| :x:
| None
| Navigation is not supported.

| `stopLoading`
| :x:
| None
| Method is present but does nothing.
|===

[[security]]
== Security Notes

This library uses
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe[`<iframe>`] elements to
render remote resources and reproduce the `WebView` component behavior.
*This comes with limitations you should be aware of.*

=== Same Origin Policy

Because of the same origin policy, `iframes` will be rendered in a restricted environment *when the origin of the WebView doesn't match the origin of the current page*.
In such restricted environments, the current page will not have access to the content of the cross origin page, and thus the following features will be affected:

- JavaScript injection will be disabled;
- Messaging will be disabled;

These restriction do not apply to inline HTML. If you are in control of the cross origin, you can however set an explicit domain in containing and contained resources to work around this issue:

```js
document.domain = "company.com";
```

https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#Changing_origin[Read more about this on MDN].

=== IFrame Attributes

You are encouraged to use props mapped to iframe attributes to address security concerns in iframes:

[width="100%",options="header"]
|===
| Iframe Attribute | IframeWebView Props | Security Gain

| `allow` | `webPolicies` | Configure which web APIs are available in the
embedded page and to which origins, such as payments, peripherals... Read
more about permissions policies
https://developer.mozilla.org/fr/docs/Web/HTTP/Feature_Policy[here].

| `csp`
| `csp`
| Enforce the embedded page to limit the range of origins from which
external resources can be loaded.

| `referrerpolicy`
| `referrerPolicy`
| Instruct which referrer the browser should attach with
HTTP requests sent to embedded pages hosts.

| `sandbox`
| `sandbox`, `sandboxEnabled`
| Whitelist embedded page capabilities (javascript, forms...).

|===


=== Content Security Policy

If you are using CSP directives, you should make sure the domain rendered in the `WebView` is whitelisted. For example, the most specific directive for embedding youtube player would be:

```
Content-Security-Policy: frame-src https://*.youtube.com;
```

If no `frame-src` directives is set, user agents will fallback to, by order of
preference, `child-src` and `default-src` directives.
https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-src[Read
more on MDN].
